<!DOCTYPE html>
<html lang="hi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>क्विज</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        transition: background-color 0.3s, color 0.3s;
      }
      .dark {
        background-color: #1f2937;
        color: #f3f4f6;
      }
      .light {
        background-color: #f9fafb;
        color: #111827;
      }
      .card {
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: opacity 0.3s ease-in-out;
      }
      .dark .card {
        background: #374151;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
      }
      .option-label {
        transition: background-color 0.2s;
        border-radius: 6px;
      }
      .option-label:hover {
        background-color: #e5e7eb;
      }
      .dark .option-label:hover {
        background-color: #4b5563;
      }
      .option-label.correct {
        background-color: #d1fae5;
      }
      .dark .option-label.correct {
        background-color: #10b981;
      }
      .option-label.incorrect {
        background-color: #fee2e2;
      }
      .dark .option-label.incorrect {
        background-color: #ef4444;
      }
      button {
        transition: transform 0.2s, background-color 0.2s;
      }
      button:hover {
        transform: scale(1.05);
      }
      .fade-in {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      .timer-circle {
        width: 50px;
        height: 50px;
        border: 4px solid #e5e7eb;
        border-top-color: #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        display: inline-block;
      }
      .dark .timer-circle {
        border-color: #4b5563;
        border-top-color: #60a5fa;
      }
      .timer-circle.paused {
        animation: none;
        border: 4px solid #3b82f6;
      }
      .dark .timer-circle.paused {
        border: 4px solid #60a5fa;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
      .modal {
        background: rgba(0, 0, 0, 0.5);
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 50;
      }
    </style>
  </head>
  <body class="light font-sans">
    <div class="container mx-auto p-6 max-w-2xl">
      <!-- Header Section -->
      <div class="flex justify-between mb-6">
        <button
          id="themeToggle"
          class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
          थीम बदलें
        </button>
        <button
          id="soundToggle"
          class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
          ध्वनि: चालू
        </button>
      </div>

      <!-- Loading Section -->
      <div id="loading" class="text-center text-lg fade-in">
        लोड हो रहा है...
      </div>

      <!-- Welcome Section -->
      <div id="welcomeSection" class="hidden card p-6 fade-in">
        <h1 class="text-3xl font-bold mb-4 text-center">
          क्विज में आपका स्वागत है!
        </h1>
        <p class="mb-4 text-center">
          निर्देश: इस क्विज में कुल <span id="totalQuestions"></span> प्रश्न
          हैं। कोई नेगेटिव मार्किंग नहीं है।
        </p>
        <div class="mb-4">
          <label class="block mb-2 font-semibold">आपका नाम:</label>
          <input
            id="userName"
            type="text"
            class="border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500 invalid:border-red-500"
            placeholder="अपना नाम दर्ज करें"
            required />
        </div>
        <div class="mb-4">
          <label class="block mb-2 font-semibold"
            >प्रति प्रश्न समय (सेकंड):</label
          >
          <input
            id="timePerQuestion"
            type="number"
            min="10"
            class="border p-3 rounded-lg w-full focus:outline-none focus:ring-2 focus:ring-blue-500"
            value="30" />
        </div>
        <div class="mb-4">
          <label class="block mb-2 font-semibold"
            >अपनी क्विज JSON अपलोड करें:</label
          >
          <input
            id="quizUpload"
            type="file"
            accept=".json"
            class="border p-3 rounded-lg w-full" />
        </div>
        <button
          id="startQuiz"
          class="bg-blue-600 text-white px-6 py-3 rounded-lg w-full hover:bg-blue-700"
          disabled>
          क्विज शुरू करें
        </button>
        <div class="mt-6">
          <p class="font-semibold">क्विज शेयर करें:</p>
          <input
            id="shareLink"
            type="text"
            class="border p-3 rounded-lg w-full mt-2 bg-gray-100 dark:bg-gray-700"
            readonly
            value="https://example.com/quiz" />
          <button
            id="copyLink"
            class="bg-gray-600 text-white px-4 py-2 rounded-lg mt-2 hover:bg-gray-700">
            लिंक कॉपी करें
          </button>
        </div>
      </div>

      <!-- Quiz Section -->
      <div id="quizSection" class="hidden card p-6 fade-in">
        <h2 class="text-2xl font-bold mb-4 text-center">डायनामिक क्विज</h2>
        <div
          class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5 mb-4">
          <div
            id="progressBar"
            class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"
            style="width: 0%"></div>
        </div>
        <p class="text-center mb-4">
          प्रश्न <span id="currentQuestion">1</span> /
          <span id="totalQuestionsQuiz"></span>
        </p>
        <div id="questionContainer" class="mb-4"></div>
        <div class="flex justify-center mb-4">
          <span id="timer" class="text-lg font-semibold mr-2">30</span>
          <span id="timerCircle" class="timer-circle"></span>
        </div>
        <div class="flex space-x-4">
          <button
            id="prevQuestion"
            class="bg-gray-600 text-white px-6 py-3 rounded-lg w-full hover:bg-gray-700">
            पिछला प्रश्न
          </button>
          <button
            id="nextQuestion"
            class="bg-blue-600 text-white px-6 py-3 rounded-lg w-full hover:bg-blue-700">
            अगला प्रश्न
          </button>
        </div>
        <div
          id="explanation"
          class="mt-4 hidden text-gray-700 dark:text-gray-300 p-4 rounded-lg bg-gray-100 dark:bg-gray-700"></div>
      </div>

      <!-- Result Section -->
      <div id="resultSection" class="hidden card p-6 fade-in">
        <h2 class="text-2xl font-bold mb-4 text-center">क्विज रिजल्ट</h2>
        <p class="text-center">आपका स्कोर: <span id="score"></span></p>
        <p class="text-center mb-4">कुल समय: <span id="totalTime"></span></p>
        <table class="w-full mt-4 border">
          <thead>
            <tr class="bg-gray-200 dark:bg-gray-700">
              <th class="border p-2">प्रश्न</th>
              <th class="border p-2">आपका उत्तर</th>
              <th class="border p-2">सही उत्तर</th>
              <th class="border p-2">परिणाम</th>
            </tr>
          </thead>
          <tbody id="resultTable"></tbody>
        </table>
        <div class="mt-6 flex justify-center space-x-4">
          <button
            id="downloadReport"
            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
            रिपोर्ट डाउनलोड करें
          </button>
          <button
            id="shareResult"
            class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
            रिजल्ट शेयर करें
          </button>
          <button
            id="tryAgain"
            class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
            फिर से ट्राई करें
          </button>
        </div>
      </div>

      <!-- Confirmation Modal -->
      <div id="confirmModal" class="modal hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
          <p class="mb-4">क्या आप वाकई क्विज को फिर से शुरू करना चाहते हैं?</p>
          <div class="flex justify-end space-x-4">
            <button
              id="confirmTryAgain"
              class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700">
              हाँ
            </button>
            <button
              id="cancelTryAgain"
              class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700">
              नहीं
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      let quizData = [];
      let currentQuestionIndex = 0;
      let userAnswers = [];
      let score = 0;
      let totalTimeTaken = 0;
      let timePerQuestion = 30;
      let timerInterval;
      let isSoundOn = true;
      let isDarkTheme = false;
      let timeLeft;

      const welcomeSection = document.getElementById("welcomeSection");
      const quizSection = document.getElementById("quizSection");
      const resultSection = document.getElementById("resultSection");
      const loading = document.getElementById("loading");
      const totalQuestionsSpan = document.getElementById("totalQuestions");
      const totalQuestionsQuiz = document.getElementById("totalQuestionsQuiz");
      const currentQuestionSpan = document.getElementById("currentQuestion");
      const quizUpload = document.getElementById("quizUpload");
      const startQuizBtn = document.getElementById("startQuiz");
      const userNameInput = document.getElementById("userName");
      const timePerQuestionInput = document.getElementById("timePerQuestion");
      const questionContainer = document.getElementById("questionContainer");
      const timerDisplay = document.getElementById("timer");
      const timerCircle = document.getElementById("timerCircle");
      const nextQuestionBtn = document.getElementById("nextQuestion");
      const prevQuestionBtn = document.getElementById("prevQuestion");
      const explanationDiv = document.getElementById("explanation");
      const scoreDisplay = document.getElementById("score");
      const totalTimeDisplay = document.getElementById("totalTime");
      const resultTable = document.getElementById("resultTable");
      const themeToggle = document.getElementById("themeToggle");
      const soundToggle = document.getElementById("soundToggle");
      const copyLinkBtn = document.getElementById("copyLink");
      const downloadReportBtn = document.getElementById("downloadReport");
      const shareResultBtn = document.getElementById("shareResult");
      const tryAgainBtn = document.getElementById("tryAgain");
      const confirmModal = document.getElementById("confirmModal");
      const confirmTryAgain = document.getElementById("confirmTryAgain");
      const cancelTryAgain = document.getElementById("cancelTryAgain");
      const progressBar = document.getElementById("progressBar");

      // Audio for feedback
      const correctSound = new Audio(
        "https://www.soundjay.com/buttons/beep-01a.mp3"
      );
      const incorrectSound = new Audio(
        "https://www.soundjay.com/buttons/beep-02.mp3"
      );

      // Handle JSON file upload
      quizUpload.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (file && file.type === "application/json") {
          const reader = new FileReader();
          reader.onload = (e) => {
            try {
              quizData = JSON.parse(e.target.result).questions;
              if (quizData && Array.isArray(quizData) && quizData.length > 0) {
                totalQuestionsSpan.textContent = quizData.length;
                totalQuestionsQuiz.textContent = quizData.length;
                startQuizBtn.disabled = false;
                loading.classList.add("hidden");
                welcomeSection.classList.remove("hidden");
              } else {
                alert("JSON फ़ाइल में वैध प्रश्न नहीं हैं।");
              }
            } catch (error) {
              alert("JSON फ़ाइल पार्स करने में त्रुटि: " + error.message);
            }
          };
          reader.readAsText(file);
        } else {
          alert("कृपया एक वैध JSON फ़ाइल अपलोड करें।");
        }
      });

      // Theme toggle
      themeToggle.addEventListener("click", () => {
        isDarkTheme = !isDarkTheme;
        document.body.classList.toggle("dark", isDarkTheme);
        document.body.classList.toggle("light", !isDarkTheme);
        themeToggle.textContent = isDarkTheme ? "लाइट थीम" : "डार्क थीम";
      });

      // Sound toggle
      soundToggle.addEventListener("click", () => {
        isSoundOn = !isSoundOn;
        soundToggle.textContent = `ध्वनि: ${isSoundOn ? "चालू" : "बंद"}`;
      });

      // Copy link
      copyLinkBtn.addEventListener("click", () => {
        navigator.clipboard.write(shareLink.value).then(() => {
          alert("लिंक कॉपी हो गया!");
        });
      });

      // Start quiz
      startQuizBtn.addEventListener("click", () => {
        if (!userNameInput.value.trim()) {
          userNameInput.classList.add("border-red-500");
          alert("कृपया अपना नाम दर्ज करें।");
          return;
        }
        userNameInput.classList.remove("border-red-500");
        timePerQuestion = parseInt(timePerQuestionInput.value) || 30;
        welcomeSection.classList.add("hidden");
        quizSection.classList.remove("hidden");
        currentQuestionIndex = 0;
        userAnswers = [];
        score = 0;
        totalTimeTaken = 0;
        loadQuestion();
      });

      // Load question
      function loadQuestion() {
        const question = quizData[currentQuestionIndex];
        timeLeft = timePerQuestion;
        timerDisplay.textContent = timeLeft;
        currentQuestionSpan.textContent = currentQuestionIndex + 1;
        progressBar.style.width = `${
          ((currentQuestionIndex + 1) / quizData.length) * 100
        }%`;

        // Build options HTML
        questionContainer.innerHTML = `
    <p class="mb-4 text-lg">${question.id}. ${question.question}</p>
    <div>
      ${Object.entries(question.options)
        .map(
          ([key, value]) => `
        <label class="option-label block mb-2 p-2 rounded-lg">
          <input type="radio" name="option" value="${key}" class="mr-2" data-explanation="${question.explanation}">
          ${key.toUpperCase()}. ${value}
        </label>
      `
        )
        .join("")}
    </div>
  `;
        explanationDiv.classList.add("hidden");
        timerCircle.classList.remove("paused");

        // Restore previous answer if exists
        const prevAnswer = userAnswers[currentQuestionIndex];
        const options = document.querySelectorAll('input[name="option"]');
        if (prevAnswer && prevAnswer.userAnswerKey) {
          options.forEach((option) => {
            if (option.value === prevAnswer.userAnswerKey) {
              option.checked = true;
              // Mark correct/incorrect
              const isCorrect = prevAnswer.isCorrect;
              const label = option.parentElement;
              label.classList.add(isCorrect ? "correct" : "incorrect");
              explanationDiv.innerHTML = `<p>${question.explanation}</p>`;
              explanationDiv.classList.remove("hidden");
              // Disable all options
              options.forEach((opt) => (opt.disabled = true));
              timerCircle.classList.add("paused");
              clearInterval(timerInterval);
            }
          });
        } else {
          // Only add event listeners if not already answered
          options.forEach((option) => {
            option.addEventListener("change", (e) => {
              const selectedValue = e.target.value;
              const isCorrect = selectedValue === question.answer;
              const label = e.target.parentElement;
              label.classList.add(isCorrect ? "correct" : "incorrect");
              explanationDiv.innerHTML = `<p>${question.explanation}</p>`;
              explanationDiv.classList.remove("hidden");
              if (isSoundOn) {
                if (isCorrect) correctSound.play();
                else incorrectSound.play();
              }
              options.forEach((opt) => {
                if (opt !== e.target) opt.disabled = true;
              });
              timerCircle.classList.add("paused");
              clearInterval(timerInterval);
            });
          });
          startTimer();
        }

        // Disable prev button on first question
        prevQuestionBtn.disabled = currentQuestionIndex === 0;
      }

      // Start timer
      function startTimer() {
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
          timeLeft--;
          timerDisplay.textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(timerInterval);
            saveAnswer();
            nextQuestion();
          }
        }, 1000);
      }

      // Save answer and move to next question
      nextQuestionBtn.addEventListener("click", () => {
        saveAnswer();
        nextQuestion();
      });

      // Add event listener for previous question
      prevQuestionBtn.addEventListener("click", () => {
        saveAnswer();
        if (currentQuestionIndex > 0) {
          currentQuestionIndex--;
          loadQuestion();
        }
      });

      function saveAnswer() {
        const selectedOption = document.querySelector(
          'input[name="option"]:checked'
        );
        const question = quizData[currentQuestionIndex];
        const userAnswer = selectedOption ? selectedOption.value : null;
        userAnswers[currentQuestionIndex] = {
          question: question.question,
          userAnswer: userAnswer
            ? question.options[userAnswer]
            : "कोई उत्तर नहीं",
          userAnswerKey: userAnswer,
          correctAnswer: question.options[question.answer],
          correctAnswerKey: question.answer,
          isCorrect: userAnswer === question.answer,
          explanation: question.explanation,
        };
        if (userAnswer === question.answer) {
          score++;
        }
        totalTimeTaken += timePerQuestion - timeLeft;
      }

      function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex < quizData.length) {
          loadQuestion();
        } else {
          clearInterval(timerInterval);
          showResults();
        }
      }

      // Show results
      function showResults() {
        quizSection.classList.add("hidden");
        resultSection.classList.remove("hidden");
        scoreDisplay.textContent = `${score}/${quizData.length}`;
        totalTimeDisplay.textContent = `${totalTimeTaken} सेकंड`;
        resultTable.innerHTML = userAnswers
          .map(
            (answer, index) => `
    <tr class="bg-white dark:bg-gray-800">
      <td class="border border-gray-300 dark:border-gray-600 p-2 text-gray-900 dark:text-gray-100">${answer.question}</td>
      <td class="border border-gray-300 dark:border-gray-600 p-2 text-gray-900 dark:text-gray-100">${answer.userAnswer}</td>
      <td class="border border-gray-300 dark:border-gray-600 p-2 text-gray-900 dark:text-gray-100">${answer.correctAnswer}</td>
      <td class="border border-gray-300 dark:border-gray-600 p-2 ${
        answer.isCorrect ? "text-green-500" : "text-red-500"
      } text-gray-900 dark:text-gray-100">
        ${answer.isCorrect ? "सही" : "गलत"}
      </td>
    </tr>
  `
          )
          .join("");
      }

      // Download report
      downloadReportBtn.addEventListener("click", () => {
        const report = `
नाम: ${userNameInput.value}
स्कोर: ${score}/${quizData.length}
कुल समय: ${totalTimeTaken} सेकंड

प्रश्न-वार परिणाम:
${userAnswers
  .map(
    (answer, index) => `
प्रश्न ${index + 1}: ${answer.question}
आपका उत्तर: ${answer.userAnswer}
सही उत्तर: ${answer.correctAnswer}
परिणाम: ${answer.isCorrect ? "सही" : "गलत"}
विवरण: ${answer.explanation}
`
  )
  .join("\n")}
      `;
        const blob = new Blob([report], { type: "text/plain" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "quiz_report.txt";
        a.click();
        URL.revokeObjectURL(url);
      });

      // Share result
      shareResultBtn.addEventListener("click", () => {
        const resultText = `मैंने ${userNameInput.value} के रूप में क्विज में ${score}/${quizData.length} स्कोर किया, कुल ${totalTimeTaken} सेकंड में!`;
        navigator.clipboard.write(resultText).then(() => {
          alert("रिजल्ट कॉपी हो गया!");
        });
      });

      // Try again with confirmation
      tryAgainBtn.addEventListener("click", () => {
        confirmModal.classList.remove("hidden");
      });

      confirmTryAgain.addEventListener("click", () => {
        confirmModal.classList.add("hidden");
        resultSection.classList.add("hidden");
        welcomeSection.classList.remove("hidden");
        quizData = [];
        userAnswers = [];
        score = 0;
        totalTimeTaken = 0;
        quizUpload.value = "";
        startQuizBtn.disabled = true;
        totalQuestionsSpan.textContent = "";
        totalQuestionsQuiz.textContent = "";
      });

      cancelTryAgain.addEventListener("click", () => {
        confirmModal.classList.add("hidden");
      });

      // Initialize
      loading.classList.remove("hidden");
      setTimeout(() => {
        loading.classList.add("hidden");
        welcomeSection.classList.remove("hidden");
      }, 1000);
    </script>
  </body>
</html>
